<?php/** * admin用一覧を取得 *  * @access public * @author 川端洋平 * @version 0.0.1 * @since 2012/07/25 *///// 設定ファイル読み込み ////require_once '../../lib-machine.php';try {    //// 認証 ////    Auth::isAuth('member');        $action = Req::query('action');    $target = Req::query('target');    $data   = Req::query('data');        $res = '';        if ($action == "getGenreList") {        $gModel = new Genre();        $res    = $gModel->getList();    } else if ($action == "getMakerListByCatalog") {        // $cModel = new Catalog();        // $res    = $cModel->getMakerGenreList();        $mModel = new Machine();        $res    = $mModel->getMakerGenreList();    } else if ($action == "getCatalogList") {        $cModel = new Catalog();        $result = $cModel->search(array(            'maker'    => $data['ma'],            'genre_id' => $data['g'],            'model'    => $data['mo'],        ), true);        $res = $result['catalogList'];    } else if ($action == "getFormLists") {        // フォーム初期化用一覧群を取得        $gModel  = new Genres();        // $cModel = new Catalog();        $mModel  = new Machine();        $coModel = new Company();                $company = $coModel->get($_user['company_id']);                $offices = $company['offices'];        array_unshift($offices, array(            'name'  => '本社',            'addr1' => $company['addr1'],            'addr2' => $company['addr2'],            'addr3' => $company['addr3'],            'lat'   => $company['lat'],            'lng'   => $company['lng'],        ));                $res = array(            'genreList'  => $gModel->getList(),            // 'makerList'  => $cModel->getMakerGenreList(),            'makerList'  => $mModel->getMakerGenreList(),            'officeList' => $offices,        );    } else if ($action == "zip2address") {        // 〒->住所処理        $temp = preg_replace('/[^0-9]/', '', B::filter($data));                $res = array('state' => '', 'city' => '', 'address' => '', 'company' => '');                if (preg_match('/[0-9]{7}/', $temp)) {            $xml = simplexml_load_file('http://zip.cgis.biz/xml/zip.php?zn=' . $temp);            $val = $xml->ADDRESS_value->value;                        if ($val[4]['state']   != 'none') { $res['state'] .= $val[4]['state']; }            if ($val[5]['city']    != 'none') { $res['city'] .= $val[5]['city']; }            if ($val[6]['address'] != 'none') { $res['address'] .= $val[6]['address']; }            if ($val[7]['company'] != 'none') { $res['company'] .= $val[7]['company']; }            /*            $res = '';            if ($val[4]['state']   != 'none') { $res.= $val[4]['state']; }            if ($val[5]['city']    != 'none') { $res.= $val[5]['city']; }            if ($val[6]['address'] != 'none') { $res.= $val[6]['address']; }            if ($val[7]['company'] != 'none') { $res.= $val[7]['company']; }            */        }    }        echo json_encode($res);} catch (Exception $e) {    echo $e->getMessage();}